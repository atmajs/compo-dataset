"use strict";!function(t,e){var n="undefined"!=typeof global?global:window,a=n.mask||n.atma&&n.atma.mask;if(null==a){if("function"!=typeof require)throw Error("MaskJS was not loaded");mask=require("maskjs")}e(n,a,a.Compo.config.getDOMLibrary())}(void 0,function(t,e,n){var a,i;!function(){i=function(t){return Object.prototype.toString.call(t).replace("[object ").replace("]")},a=function(t,e){var n=void 0===arguments[2]?{}:arguments[2];if(null==t)return n;var i=_getType(t);if("Array"===i)return t.forEach(function(t,i){a(t,e+"["+i+"]",n)}),n;if("Object"===i){e&&(e+=".");var o,r,s;for(o in t)if(r=t[o],s=e+o,null!=r){var i=_getType(r);switch(i){case"Object":case"Array":a(r,s,n);continue;case"String":case"Number":case"Boolean":case"Blob":s in n&&console.warn("ToFormData: Overwrite property",s),n[s]=r;continue;default:console.error("Possible type violation",i),n[s]=r;continue}}return n}switch(i){case"String":case"Number":case"Boolean":case"Blob":break;default:console.error("Possible type violation",i)}return e in n&&console.warn("ToFormData: Overwrite property",e),n[e]=t,n}}();var o;!function(){o=function(t,e){var n=void 0===arguments[2]?"":arguments[2],i=a(e,n);for(var o in i){var r=null,s=i[o];"object"==typeof s&&s.fileName&&(r=s.fileName),null==r?t.append(o,s):t.append(o,s,r)}}}();var r;!function(){r=function(t,n){e.TreeWalker.walk(t,function(e){return e!==t?n(e):void 0})}}();var s;!function(){s=e["class"].create(e["class"].EventEmitter,e["class"].Deferred,{constructor:function(t,e){this.url=t,this.method=e,this.xhr_=null,this.loadPercent=0,this.uploadPercent=0,this.headers={}},write:function(t){return this.data=t,"Object"===i(t)&&(this.data=JSON.stringify(t)),this},writeHeaders:function(t){return e.obj.extend(this.headers,t),this},setEndpoint:function(t,e){return this.url=t,this.method=e,this},isBusy:function(){return null!=this.xhr_},loading_:function(t){this.emit("progress","load",this.loadPercent=t)},uploading_:function(t){this.emit("progress","upload",this.uploadPercent=t)},readResponse_:function(t){var e=this.xhr_,n=e.responseText||"",a=e.getResponseHeader("content-type");if(null==a)return t(Error("Content-Type not set"));if(/json/i.test(a))try{n=JSON.parse(n)}catch(i){return t(Error("Json response malformed: "+String(i)))}return 200===e.status?t(null,n):t(this.toError_(e,n))},toError_:function(t,e){var n=t.status,a=t.responseText||t.statusText;return null!=e&&"object"==typeof e&&(n=e.status||n,a=e.message||e.error||a),new d(a,n)},complete_:function(t,e){return this.loading_(100),this.xhr_=null,t?(this.emit("error",t),void this.reject(t)):(this.emit("complete",e),void this.resolve(e))},send:function(){var t=this;if(this.isBusy())throw Error("Request is not reusable");var e=this.xhr_=new XMLHttpRequest;e.onload=function(){t.readResponse_(function(e,n){return t.complete_(e,n)})},e.upload&&(e.upload.onprogress=function(e){if(e.lengthComputable){var n=(e.loaded,e.total,e.loaded/e.total*100|0);return void t.uploading_(n)}return t.uploadPercent<90?void t.uploading_(t.uploadPercent+10):void t.uploading_(100)}),e.open(this.method,this.url);for(var n in this.headers)e.setRequestHeader(n,this.headers[n]);return this.emit("start"),e.send(this.data),this}})}();var l,c=(e["class"].create({run:function(t){for(var e=this,n=arguments.length,a=Array(n>1?n-1:0),i=1;n>i;i++)a[i-1]=arguments[i];this.error=null;var o,r=this[t];return a.unshift(this),r.forEach(function(t){e.error||(o=e.perform(t,a))}),o},perform_:function(t,e){var n="string"==typeof t?this[t]:t;try{return n.apply(null,e)}catch(a){this.error=a,this.throw_(a)}},throw_:function(t){throw t}}),e["class"].create(Object.defineProperties({body:null,headers:null,method:"POST",endpoint:window.location.href,contentType:"application/json",constructor:function(t){var e=void 0===arguments[1]?{}:arguments[1];this.body=t,this.headers=e.headers,e.endpoint&&(this.endpoint=e.endpoint),e.method&&(this.method=e.method),e.contenType&&(this.contentType=e.contentType)},serializeHeaders:function(){var t={"Content-Type":this.contentType};return e.obj.extend(t,this.headers)},serialize:function(){return/form-data/i.test(this.contentType)?this.formData:JSON.stringify(this.body)}},{formData:{get:function(){var e=new t.FormData;return o(e,this.body),e},configurable:!0,enumerable:!0}}))),d=(e["class"].createError("ValidationError",{constructor:function(t){null!=t&&"object"==typeof t&&(this.message=t.message||t.error||String(t))},message:""}),e["class"].createError("HttpError",{status:500,message:"",constructor:function(t,e){this.status=e,this.message=t}}));!function(){l={getJson:function(t){return new s(t,"GET").send()},upload:function(t){var e=t.endpoint,n=t.method,a=(t.serialize(),new s(e,n));return a.write(t.serialize()).writeHeaders(t.serializeHeaders()).send()}}}();var u;!function(){u={process:function(t){var e;return r(t,function(t){var n=t.compoName;if((":dualbind"===n||"dualbind"===n)&&(e=t.provider.validate()))return{"break":!0};var a=t.validateUi||t.validate;return null!=a&&(e=a.call(t))?{"break":!0}:void 0}),e}}}();var h;!function(){function t(t){var n=t.model,a=e.obj.extend({},n);return r(t,function(t){var n=t.toJson||t.toJSON;if(n){var i=n.call(t);return e.obj.extend(a,i),{deep:!1}}}),a}h={createMessage:function(e){var n=void 0===arguments[1]?{}:arguments[1],a=t(e),i=n.contentType||e.xContenType,o=n.action||e.xAction,r=n.method||e.xMethod;return new c(a,{contentType:i,endpoint:o,method:r})}}}();var p=e.Compo({tagName:"div",meta:{template:"merge"},attr:{style:"position: relative;"},slots:{datasetItemRemove:function(t){var e=this,a=n(t.target).model();this.find("Confirmation").confirm("remove",a).done(function(){var t=e.data.collection,n=t.indexOf(a);t.splice(n,1)})},datasetItemEdit:function(t){var e=n(t.target).model();this.find("Editor").edit(e)},datasetItemNew:function(t){var e=this,n=this.createDataItem();this.find("Editor").edit(n).done(function(t){e.data.collection.push(t)})}},filter:function(t){var e=this.find("#provider");e&&e.filter&&e.filter(t)},activity:function(t){this.emitIn("datasetActivity",t)},onRenderStart:function(t,e,n){jmask(this).prepend("Activity; Confirmation;"),this.ensureDataProvider_()},createDataItem:function(){return{}},ensureDataProvider_:function(){null!=this.xEndpoint&&jmask(this).prepend("ModelDataProvider")}});e.registerFromTemplate("\n	// source Controls/Activity.mask\n	let Activity as (div.a-dataset-activity) {\n		\n		var activity = 0;\n		\n		slot datasetActivity (sender, diff) {\n			var count = this.scope.activity + diff;\n			if (count < 0) count = 0;\n			this.scope.activity = count;\n		}\n		\n		style {\n			.a-dataset-activity-backdrop {\n				position: absolute;\n				\n				top:0;\n				left:0;\n				width: 100%;\n				height: 100%;\n				background: rgba(255,255,255, .8);\n				z-index: 100;\n			}\n			.a-dataset-activity-spinner {\n				width: 40px;\n				height: 40px;\n			  \n				position: relative;\n				margin: auto;\n			}\n			.a-dataset-activity-bounce1, .a-dataset-activity-bounce2 {\n				width: 100%;\n				height: 100%;\n				border-radius: 50%;\n				background-color: #27ae60;\n				opacity: 0.6;\n				position: absolute;\n				top: 0;\n				left: 0;			\n				-webkit-animation: bounce 2.0s infinite ease-in-out;\n				animation: bounce 2.0s infinite ease-in-out;\n			}		\n			.a-dataset-activity-bounce2 {\n				-webkit-animation-delay: -1.0s;\n				animation-delay: -1.0s;\n			}\n			\n			@-webkit-keyframes bounce {\n				0%, 100% { -webkit-transform: scale(0.0) }\n				50% { -webkit-transform: scale(1.0) }\n			}\n			\n			@keyframes bounce {\n				0%, 100% { \n					transform: scale(0.0);\n					-webkit-transform: scale(0.0);\n				} 50% { \n					transform: scale(1.0);\n					-webkit-transform: scale(1.0);\n				}\n			}\n		}\n		\n		+if ($scope.activity > 0) {		\n			.a-dataset-activity-backdrop >\n				.a-dataset-activity-spinner {\n					.a-dataset-activity-bounce1;\n					.a-dataset-activity-bounce2;\n				}\n		}\n	}\n	// end:source Controls/Activity.mask\n	// source Controls/Confirmation.mask\n	let Confirmation {\n		\n		function confirm(type, model) {\n			var compo = this;\n			return mask.class.Deferred.run(function(resolve, reject){\n	\n				var msg = compo.getMessage_(type, model);\n				var confirmed = confirm(msg);\n	\n				if (confirmed) {\n					return resolve();\n				}\n				reject();\n			});\n		}\n	\n		function getMessage_(type, model) {\n			if ('remove' === type)\n				return 'Are you sure to remove the item?';\n		}\n		\n	}\n	// end:source Controls/Confirmation.mask\n	// source Controls/Dialog.mask\n	let Dialog {\n		\n		function show () {\n			this.$.modal('show');\n		}\n		function hide () {\n			this.$.modal('hide');\n		}\n		\n		slot datasetEditorOpen () {\n			this.show();\n			return false;\n		}\n		\n		slot datasetEditorClose () {\n			this.hide();\n			return false;\n		}\n		\n		slot complete () {\n			this.hide();\n		}\n		\n		.modal.fade > .modal-dialog.modal-lg > .modal-content {\n				.modal-header {\n					\n					button.close data-dismiss= modal > span > 'x';\n					h4 .modal-title {\n						'Â ' @title;\n					}\n				}\n				@body > .modal-body style='position:relative; height:@attr.height' > @placeholder;\n				.modal-footer {\n					@footer;\n				}\n			}\n	}\n	// end:source Controls/Dialog.mask\n	// source Controls/Table.mask\n	let Table {\n		\n		let Item {\n			tr {\n				@each (row) {\n					td > @placeholder;\n				}\n				td {\n					@if (actions) {\n						@actions;\n					}\n					@else {\n						a .btn.btn-sm title='Edit'   x-tap=datasetItemEdit   > i.glyphicon.glyphicon-pencil;\n						a .btn.btn-sm title='Remove' x-tap=datasetItemRemove > i.glyphicon.glyphicon-trash;\n					}\n				}\n			}\n		}\n		\n		table.table.table-striped.table-hover {\n			thead > tr {\n				@each (head) {\n		    		th > @placeholder;\n		    	}\n				th > ''\n		    }\n		    tbody {\n		    	+each(data.collection) > @template;\n			}\n		}\n	}\n	// end:source Controls/Table.mask\n",p),function(){var t=e.Compo(e["class"].Deferred,{tagName:"div",meta:{mode:"client",template:"merge"},attr:{"class":"a-dataset-editor"},compos:{form:"compo: a:form"},slots:{complete:function(t,e){this.resolve(e)}},onRenderStart:function(t,e,n,a){this.model={}},onRenderEnd:function(){null==this.compos.form&&console.warn("Dataset Component. When using `Editor`, it must contain `a:form` component")},edit:function(t){return this.defer(),this.compos.form.setEntity(t),this.emitIn("datasetEditorOpen"),this}});e.registerHandler(p,"Editor",t)}();var m=Compo({aDataset:null,onRenderStart:function(t){var n=e.Utils.Expression.eval(this.expression,t);this.model={data:{collection:n}},this.aDataset=this.closest("a:dataset"),this.aDataset.data=this.model.data}});e.registerHandler(p,"Model",m);var f=function(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0})},g=Compo({template:"\n		// source Pager.mask\n		@placeholder;\n		\n		.a-dataset-pager {\n			i.glyphicon.glyphicon-road;\n			.shadow-z-1 {\n				style scoped {\n					:host {\n						display: inline;\n						margin: 0px 10px;\n						padding: 10px 20px;\n						background: white;\n						color: gray;\n					}\n				}\n				\n				+if (activity === 0) {\n				\n					span > +if (pageNum != 1) {\n						button.btn.btn-sm x-tap=datasetPagePrev >\n							i.glyphicon.glyphicon-arrow-left;\n					}\n					span > b > ' ~[bind: pageNum]/~[bind: pageTotal]'\n			\n					span > +if (isLastPage != true) {\n						button.btn.btn-sm x-tap=datasetPageNext >\n							i.glyphicon.glyphicon-arrow-right;\n					}\n				}\n				else {\n					button.btn.btn-sm > i.fa.fa-circle-o-notch.fa-spin;\n				}\n			}\n		}\n		// end:source Pager.mask\n	",attr:{id:"provider"},filterQuery:null,meta:{template:"merge",attributes:{endpoint:"string","page-num":{"default":1},"page-size":{"default":10},"query-page-num":"page","query-page-size":"size","prop-collection":"collection","prop-is-last":"","prop-total":"total"}},slots:{datasetPagePrev:function(){this.go_(-1)},datasetPageNext:function(){this.go_(1)}},filter:function(t){this.filterQuery=t,this.load_()},aDataset:null,onRenderStart:function(t,e,n,a){this.model={data:{collection:null},pageNum:this.xPageNum,pageSize:this.xPageSize,pageTotal:null,isLastPage:!1,activity:0},this.aDataset=this.closest("a:dataset"),this.readQuery_(),this.load_()},readQuery_:function(){function t(t,e){var a=n[t];null!=a&&(a=parseInt(a),isNaN(a)||e(a))}var e=this;if("undefined"!=typeof ruta){var n=ruta._.query.get();null!=n&&(t(this.xQueryPageNum,function(t){return e.model.pageNum=t}),t(this.xQueryPageSize,function(t){return e.model.pageSize=t}))}},go_:function(t){this.model.pageNum+=t,this.load_()},activity_:function(t){this.aDataset.activity(t)},load_:function(){var t=this;this.activity_(1);var a=function(){var e={};return f(e,t.xQueryPageNum,t.model.pageNum),f(e,t.xQueryPageSize,t.model.pageSize),e}();return this.filterQuery&&e.obj.extend(a,this.filterQuery),"undefined"!=typeof ruta&&ruta.navigate(a,{extend:!0}),n.getJSON(this.xEndpoint,a).done(function(e){t.setData_(e),t.activity_(-1)})},setData_:function(t){this.model.data.collection=t[this.xPropCollection];var e=!1;if(this.xPropIsLast)e=t[this.xPropIsLast];else if(this.xPropTotal){var n=this.model.pageNum*this.model.pageSize;n>=t[this.xPropTotal]&&(e=!0)}else this.model.data.collection.length<this.xPageSize&&(e=!0);this.model.pageTotal=Math.ceil(t[this.xPropTotal]/this.xPageSize),this.model.isLastPage=e}});e.registerHandler(p,"Pager",g),e.registerHandler("a:dataset",p)});
//# sourceMappingURL=dataset.min.js.map