/*!
 * Dataset Component v0.9.14
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2016 Atma.js and other contributors
 */
"use strict";!function(t,n){var e="undefined"!=typeof global?global:window,i=e.mask||e.atma&&e.atma.mask;if(null==i){if("function"!=typeof require)throw Error("MaskJS was not loaded");mask=require("maskjs")}n(e,i,i.Compo.config.getDOMLibrary())}(void 0,function(t,n,e){var i;!function(){i=function(t){if(t.constructor!==Object&&0===t.constructor.length)return new t.constructor;var e,i,a={};for(e in t)i=t[e],n.is.Array(i)?a[e]=[]:n.is.Object(i)?a[e]={}:a[e]=null;return a}}();var a=n.Compo({tagName:"div",meta:{template:"merge"},attr:{style:"position: relative;"},slots:{datasetItemRemove:function(t){var n=this,i=e(t.target).model(),a=function(){n.find("Editor").remove(i).done(o).fail(r)},o=function(){n.find("#provider").removeEntity(i)},r=function(t){alert("Error "+t.message)};this.find("Confirmation").confirm("remove",i).done(a)},datasetItemEdit:function(t){var n=this,i=e(t.target).compo();this.find("Editor").edit(i.model,i).done(function(t){var e=n.find("#provider");e.updateEntity&&e.updateEntity(t)})},datasetItemNew:function(t){var n=this,e=this.createDataItem();this.find("Editor").edit(e).done(function(t){var e=n.find("#provider");e.addEntity&&e.addEntity(t)})}},filter:function(t){var n=this.find("#provider");n.filter&&n.filter(t)},activity:function(t){this.emitIn("datasetActivity",t)},onRenderStart:function(t,n,e){jmask(this).append("Activity; Confirmation;"),this.ensureDataProvider_()},createDataItem:function(){var t=this.find("#provider"),e=n.obj.get(t,"model.data.collection.0")||{};return i(e)},ensureDataProvider_:function(){null!=this.xEndpoint&&jmask(this).prepend("ModelDataProvider")}});n.registerFromTemplate("\n\t// source Controls/Activity.mask\n\tlet Activity as (div.a-dataset-activity) {\n\t\t\n\t\tvar activity = 0;\n\t\t\n\t\tslot datasetActivity (sender, diff) {\n\t\t\tvar count = this.scope.activity + diff;\n\t\t\tif (count < 0) count = 0;\n\t\t\tthis.scope.activity = count;\n\t\t}\n\t\t\n\t\tstyle {\n\t\t\t.a-dataset-activity-backdrop {\n\t\t\t\tposition: absolute;\n\t\t\t\t\n\t\t\t\ttop:0;\n\t\t\t\tleft:0;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tbackground: rgba(255,255,255, .8);\n\t\t\t\tz-index: 100;\n\t\t\t}\n\t\t\t.a-dataset-activity-spinner {\n\t\t\t\twidth: 40px;\n\t\t\t\theight: 40px;\n\t\t\t  \n\t\t\t\tposition: relative;\n\t\t\t\tmargin: auto;\n\t\t\t}\n\t\t\t.a-dataset-activity-bounce1, .a-dataset-activity-bounce2 {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tborder-radius: 50%;\n\t\t\t\tbackground-color: #27ae60;\n\t\t\t\topacity: 0.6;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\t\t\t\n\t\t\t\t-webkit-animation: bounce 2.0s infinite ease-in-out;\n\t\t\t\tanimation: bounce 2.0s infinite ease-in-out;\n\t\t\t}\t\t\n\t\t\t.a-dataset-activity-bounce2 {\n\t\t\t\t-webkit-animation-delay: -1.0s;\n\t\t\t\tanimation-delay: -1.0s;\n\t\t\t}\n\t\t\t\n\t\t\t@-webkit-keyframes bounce {\n\t\t\t\t0%, 100% { -webkit-transform: scale(0.0) }\n\t\t\t\t50% { -webkit-transform: scale(1.0) }\n\t\t\t}\n\t\t\t\n\t\t\t@keyframes bounce {\n\t\t\t\t0%, 100% { \n\t\t\t\t\ttransform: scale(0.0);\n\t\t\t\t\t-webkit-transform: scale(0.0);\n\t\t\t\t} 50% { \n\t\t\t\t\ttransform: scale(1.0);\n\t\t\t\t\t-webkit-transform: scale(1.0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t+if ($scope.activity > 0) {\t\t\n\t\t\t.a-dataset-activity-backdrop >\n\t\t\t\t.a-dataset-activity-spinner {\n\t\t\t\t\t.a-dataset-activity-bounce1;\n\t\t\t\t\t.a-dataset-activity-bounce2;\n\t\t\t\t}\n\t\t}\n\t}\n\t// end:source Controls/Activity.mask\n\t// source Controls/Confirmation.mask\n\tlet Confirmation {\n\t\t\n\t\tfunction confirm(type, model) {\n\t\t\tvar compo = this;\n\t\t\treturn mask.class.Deferred.run(function(resolve, reject){\n\t\n\t\t\t\tvar msg = compo.getMessage_(type, model);\n\t\t\t\tvar confirmed = confirm(msg);\n\t\n\t\t\t\tif (confirmed) {\n\t\t\t\t\treturn resolve();\n\t\t\t\t}\n\t\t\t\treject();\n\t\t\t});\n\t\t}\n\t\n\t\tfunction getMessage_(type, model) {\n\t\t\tif ('remove' === type)\n\t\t\t\treturn 'Are you sure to remove the item?';\n\t\t}\n\t\t\n\t}\n\t// end:source Controls/Confirmation.mask\n\t// source Controls/Dialog.mask\n\tlet Dialog {\n\t\t\n\t\tfunction show () {\n\t\t\tthis.$.modal('show');\n\t\t}\n\t\tfunction hide () {\n\t\t\tthis.$.modal('hide');\n\t\t}\n\t\t\n\t\tslot datasetEditorOpen () {\n\t\t\tthis.show();\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tslot datasetEditorClose () {\n\t\t\tthis.hide();\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tslot complete () {\n\t\t\tthis.hide();\n\t\t}\n\t\t\n\t\t.modal.fade > .modal-dialog.modal-lg > .modal-content {\n\t\t\t\t.modal-header {\n\t\t\t\t\t\n\t\t\t\t\tbutton.close data-dismiss= modal > span > 'x';\n\t\t\t\t\th4 .modal-title {\n\t\t\t\t\t\t'Â ' @title;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t@body > .modal-body style='position:relative; height:@attr.height' > @placeholder;\n\t\t\t\t.modal-footer {\n\t\t\t\t\t@footer;\n\t\t\t\t}\n\t\t\t}\n\t}\n\t// end:source Controls/Dialog.mask\n\t// source Controls/Inline.mask\n\tlet Inline {\n\t\n\t\tfunction constructor () {\n\t\t\tthis.currentCompo = null;\n\t\t}\n\t\tfunction show (compo) {\n\t\t\tif (this.currentCompo) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\n\t\t\tcompo.$.hide();\n\t\t\tthis.$elements.insertBefore(compo.$);\n\t\t\tthis.currentCompo = compo;\n\t\t}\n\t\tfunction hide () {\n\t\t\tif (this.currentCompo == null)\n\t\t\t\treturn;\n\t\n\t\t\tthis.$elements.detach();\n\t\t\tthis.currentCompo.$.show();\n\t\t\tthis.currentCompo = null;\n\t\t}\n\t\tslot datasetEditorOpen (sender, compo) {\n\t\t\tthis.show(compo);\n\t\t}\n\t\tslot datasetEditorClose () {\n\t\t\tthis.hide();\n\t\t}\n\t\tslot complete () {\n\t\t\tthis.hide();\n\t\t}\n\t\tfunction onRenderEnd () {\n\t\t\tthis.$elements = this.$.children().detach();\n\t\t}\n\t\tdiv style='display: none' > @placeholder;\n\t}\n\t// end:source Controls/Inline.mask\n\t// source Controls/Table.mask\n\tlet Table {\n\t\t\n\t\tlet Item {\n\t\t\ttr {\n\t\t\t\t@each (row) {\n\t\t\t\t\ttd > @placeholder;\n\t\t\t\t}\n\t\t\t\ttd {\n\t\t\t\t\t@if (actions) {\n\t\t\t\t\t\t@actions;\n\t\t\t\t\t}\n\t\t\t\t\t@else {\n\t\t\t\t\t\ta .btn.btn-sm title='Edit'   x-tap=datasetItemEdit   > i.glyphicon.glyphicon-pencil;\n\t\t\t\t\t\ta .btn.btn-sm title='Remove' x-tap=datasetItemRemove > i.glyphicon.glyphicon-trash;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\ttable.table.table-striped.table-hover {\n\t\t\tthead > tr {\n\t\t\t\t@each (head) {\n\t\t    \t\tth > @placeholder;\n\t\t    \t}\n\t\t\t\tth > ''\n\t\t    }\n\t\t    tbody {\n\t\t    \t+each(data.collection) > @template;\n\t\t\t}\n\t\t}\n\t}\n\t// end:source Controls/Table.mask\n\t// source Controls/List.mask\n\tlet List as (ul.unstyled) {\n\t\n\t\tlet Actions {\n\t\t\ta .btn.btn-sm title='Edit'   x-tap=datasetItemEdit   > i.glyphicon.glyphicon-pencil;\n\t\t\ta .btn.btn-sm title='Remove' x-tap=datasetItemRemove > i.glyphicon.glyphicon-trash;\n\t\t}\n\t\t\n\t\t+each(data.collection) > li > @template;\n\t}\n\t// end:source Controls/List.mask\n",a),function(){var t=n.Compo(n.class.Deferred,{tagName:"div",meta:{mode:"client",template:"merge"},attr:{class:"a-dataset-editor"},compos:{form:"compo: a:form"},slots:{complete:function(t,n){this.resolve(n)},error:function(t){var n=function(n,e){return t.apply(this,arguments)};return n.toString=function(){return t.toString()},n}(function(t,n){this.reject(n)})},onRenderStart:function(t,n,e,i){this.model={}},onRenderEnd:function(){null==this.compos.form&&console.warn("Dataset Component. When using `Editor`, it must contain `a:form` component")},edit:function(t,n){return this.defer(),this.compos.form.setEntity(t),this.emitIn("datasetEditorOpen",n),this},remove:function(t){return this.defer(),this.compos.form.removeEntity(t),this}});n.registerHandler(a,"Editor",t)}(),function(){var t={attr:{id:"provider"},filterQuery:null,meta:{template:"merge",attributes:{endpoint:"string","enable-ruta":!0}},slots:{datasetFilter:function(t,n){this.filter(n)}},filter:function(t){for(var n in this.filterQuery)null!=t&&void 0!==t[n]||(this.filterQuery[n]=null);null!=t&&(this.filterQuery=t),this.load_()},aDataset:null,onRenderStart:function(t,n,e,i){this.model={data:{collection:null},activity:0},this.aDataset=this.closest("a:dataset"),this.onRenderStart_(),this.readQuery_(),this.load_()},onRenderStart_:function(){},addEntity:function(t){var n=this.model.data.collection;null==n&&(n=this.model.data.collection=[]),n.push(t)},updateEntity:function(t){var n=this.model.data.collection;null==n&&(n=this.model.data.collection=[]);var e=n.indexOf(t);n.splice(e,1,t)},removeEntity:function(t){var n=this.model.data.collection,e=n.indexOf(t);n.splice(e,1)},readQuery_:function(){function t(t,n){var i=e[t];null!=i&&(i=parseInt(i),isNaN(i)||n(i))}var n=this;if("undefined"!=typeof ruta&&this.xEnableRuta===!0){var e=ruta._.query.get();if(null!=e){t(this.xQueryPageNum,function(t){return n.model.pageNum=t}),t(this.xQueryPageSize,function(t){return n.model.pageSize=t});for(var i in e)i!==this.xQueryPageNum&&i!==this.xQueryPageSize&&(null==this.filterQuery&&(this.filterQuery={}),this.filterQuery[i]=e[i])}}},activity_:function(t){this.aDataset.activity(t)},load_:function(){var t=this;this.activity_(1);var n=this.createQuery_();if(this.filterQuery)for(var i in this.filterQuery)n[i]=this.filterQuery[i];return"undefined"!=typeof ruta&&this.xEnableRuta&&ruta.navigate(n,{extend:!0}),e.getJSON(this.xEndpoint,n).done(function(n){t.setData_(n),t.activity_(-1)})},createQuery_:function(){return{}},setData_:function(t){throw Error("Not Implemented")}},i=Compo({aDataset:null,onRenderStart:function(t){var e=n.Utils.Expression.eval(this.expression,t);this.model={data:{collection:e}},this.aDataset=this.closest("a:dataset"),this.aDataset.data=this.model.data},addEntity:function(t){var n=this.model.data.collection;n&&n.push(t)}});n.registerHandler(a,"Model",i);var o=function(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0})},r=Compo(t,{template:"\n\t\t// source Pager.mask\n\t\t@placeholder;\n\t\t\n\t\t.a-dataset-pager {\n\t\t\ti.glyphicon.glyphicon-road;\n\t\t\t.shadow-z-1 {\n\t\t\t\tstyle scoped {\n\t\t\t\t\t:host {\n\t\t\t\t\t\tdisplay: inline;\n\t\t\t\t\t\tmargin: 0px 10px;\n\t\t\t\t\t\tpadding: 10px 20px;\n\t\t\t\t\t\tbackground: white;\n\t\t\t\t\t\tcolor: gray;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t+if (activity === 0) {\n\t\t\t\t\n\t\t\t\t\tspan > +if (pageNum != 1) {\n\t\t\t\t\t\tbutton.btn.btn-sm x-tap=datasetPagePrev >\n\t\t\t\t\t\t\ti.glyphicon.glyphicon-arrow-left;\n\t\t\t\t\t}\n\t\t\t\t\tspan > b > ' ~[bind: pageNum]/~[bind: pageTotal]'\n\t\t\t\n\t\t\t\t\tspan > +if (isLastPage != true) {\n\t\t\t\t\t\tbutton.btn.btn-sm x-tap=datasetPageNext >\n\t\t\t\t\t\t\ti.glyphicon.glyphicon-arrow-right;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tbutton.btn.btn-sm > i.fa.fa-circle-o-notch.fa-spin;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// end:source Pager.mask\n\t",attr:{id:"provider"},filterQuery:null,meta:{attributes:{"page-num":{default:1},"page-size":{default:10},"query-page-num":"page","query-page-size":"size","prop-collection":"collection","prop-is-last":"","prop-total":"total"}},slots:{datasetPagePrev:function(){this.go_(-1)},datasetPageNext:function(){this.go_(1)}},filter:function(n){this.model.pageNum=1,t.filter.call(this,n)},aDataset:null,onRenderStart_:function(){this.model=n.obj.extend(this.model,{pageNum:this.xPageNum,pageSize:this.xPageSize,pageTotal:null,isLastPage:!1})},go_:function(t){this.model.pageNum+=t,this.load_()},createQuery_:function(){var t=this;return function(){var n={};return o(n,t.xQueryPageNum,t.model.pageNum),o(n,t.xQueryPageSize,t.model.pageSize),n}()},setData_:function(t){this.model.data.collection=t[this.xPropCollection];var n=!1;if(this.xPropIsLast)n=t[this.xPropIsLast];else if(this.xPropTotal){var e=this.model.pageNum*this.model.pageSize;e>=t[this.xPropTotal]&&(n=!0)}else this.model.data.collection.length<this.xPageSize&&(n=!0);this.model.pageTotal=Math.ceil(t[this.xPropTotal]/this.xPageSize),this.model.isLastPage=n}});n.registerHandler(a,"Pager",r);var s=Compo(t,{setData_:function(t){this.model.data.collection=t}});n.registerHandler(a,"Collection",s)}(),n.registerHandler("a:dataset",a)});
//# sourceMappingURL=dataset.min.js.map